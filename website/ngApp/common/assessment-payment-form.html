<div class="portlet-box white payment_bl margin-vertical">
    <div class="portlet-header">
        <div class="title">Payment</div>
    </div>

    <div class="portlet-body" style="position: relative;">
        <div class="loading-overlay" data-ng-show="$ctrl.isLoading_Payment"></div>

        <div data-ng-if="$ctrl.customFinancialInstructions">
            <div style="font-family: inherit; font-size: 1rem;" data-ng-bind-html="$ctrl.customFinancialInstructions"></div>
            <hr />
        </div>

        <div id="dwolla-form" class="mb-4" data-ng-if="$ctrl.isDwollaEnabledOnGroup">
            <div data-ng-if="$ctrl.isDwollaUserAccountVerified && !$ctrl.hasDwollaFundingSource">
                Your Dwolla user account is verified, you can now associate a bank account (savings or checking) to make payments:
                <br />
                <br />
                <div data-ng-if="$ctrl.hasComplexPassword">
                    <input type="button" class="btn btn-primary" id="start" value="Add Bank Account" ng-click="$ctrl.dwollaStartIAV()" data-ng-if="!$ctrl.isLoadingDwolla" />
                    <img src="/assets/images/spinner-large.gif" data-ng-if="$ctrl.isLoadingDwolla" />
                </div>
                <div data-ng-if="!$ctrl.hasComplexPassword" style="font-weight: bold; color: red;">
                    In order to sign-up to make Dwolla payments you must use a complex password. Please visit <a href="#!/MyProfile">your profile</a> to update your password.
                </div>
            </div>
            <div data-ng-if="$ctrl.hasDwollaFundingSource && !$ctrl.dwollaFundingSourceIsVerified">
                Your bank account is still pending micro-deposit verification. <a href="https://help.communityally.org/how-to-make-an-online-payment/" target="_blank">Dwolla Sign-up Help Guide</a>
                <br />
                <button type="button" class="btn btn-primary" data-ng-click="$ctrl.shouldShowDwollaMicroDepositModal = true">Enter Micro-Deposit Amounts</button>
                <br />
                <span class="note-text">(If you're seeing this but are not expecting to enter micro-deposits, please contact support.)</span>
                <div class="mt-3 text-start note-text">
                    Account: {{$ctrl.dwollaFundingSourceName}} - <span class="text-link note-text" data-ng-click="$ctrl.unlinkDwollaFundingSource()">Unlink bank account</span>
                </div>
            </div>
            <div ng-if="!$ctrl.isDwollaUserAccountVerified && $ctrl.allowDwollaSignUp">
                <div id="dwolla-sign-up" data-ng-if="$ctrl.dwollaUserStatus === 'checking'">
                    <img src="/assets/images/spinner-large.gif" />
                </div>
                <div id="dwolla-sign-up" class="container" data-ng-if="$ctrl.dwollaUserStatus !== 'checking'">
                    <div data-ng-if="$ctrl.dwollaUserStatus === 'new' || $ctrl.dwollaUserStatus === 'retry'">
                        <div class="row mb-3" data-ng-if="$ctrl.dwollaUserStatus === 'retry'">
                            <div class="col-12 text-error">
                                The initial identity verification attempt failed because the information provided did not satisfy Dwolla’s verification check. Please try again by entering your full Social Security number and adjusting any fields that are incorrect.
                            </div>
                        </div>
                        <div class="row mb-3" data-ng-if="$ctrl.dwollaUserStatus !== 'retry'">
                            <div class="col-12">
                                Your association has enabled Dwolla to allow you to pay dues and other fees via a checking account right here on the site. (Cards not supported)<br />
                                <br />
                                In order to make payments to your association, Dwolla needs to first verify your identity. Please complete the information below. <a href="https://help.communityally.org/how-to-make-an-online-payment/" target="_blank">Dwolla Sign-up Help Guide</a>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-12">
                                <span class="fw-bold">Name:</span> <span>{{$ctrl.userFullName}}</span>
                                <span class="fw-bold">Email:</span> <span>{{$ctrl.userEmail}}</span>
                                <br />
                                <span class="note-text">Edit this information in <a href="#!/MyProfile">your profile</a>.</span>
                            </div>
                        </div>
                        <div class="row mb-3">
                            <div class="col-6">Date of Birth: <input type="text" class="form-control form-control-sm" data-ng-model="$ctrl.dwollaSignUpInfo.dateOfBirth" data-ui-date="{changeYear: true, yearRange: '1900:+0'}" /></div>
                            <div data-ng-if="$ctrl.dwollaUserStatus !== 'retry'" class="col-6">Last 4 of SSN: <input type="password" class="form-control form-control-sm" maxlength="4" data-ng-model="$ctrl.dwollaSignUpInfo.ssnLast4" /></div>
                            <div data-ng-if="$ctrl.dwollaUserStatus === 'retry'" class="col-6">Full SSN: <input type="password" class="form-control form-control-sm" maxlength="11" data-ng-model="$ctrl.dwollaSignUpInfo.ssnFull" /></div>
                        </div>
                        <div class="row mb-3" data-ng-if="!$ctrl.shouldShowEditDwollaSignUpAddress && $ctrl.dwollaUserStatus !== 'retry'">
                            <div class="col-12"><span class="fw-bold">Home Address:</span> <span>{{$ctrl.dwollaSignUpInfo.streetAddress.oneLiner}}</span> <span class="note-text text-link" data-ng-click="$ctrl.shouldShowEditDwollaSignUpAddress = true">edit</span></div>
                        </div>
                        <street-address-form data-ng-if="$ctrl.shouldShowEditDwollaSignUpAddress || $ctrl.dwollaUserStatus === 'retry'" data-street-address="$ctrl.dwollaSignUpInfo.streetAddress" should-hide-name="true"></street-address-form>
                        <div class="row mb-2">
                            <div class="col-12">
                                <label><input type="checkbox" data-ng-model="$ctrl.didAgreeToDwollaTerms" /> By checking this box you agree to <a target="_blank" href="https://login.condoally.com/TermsOfService.html">Our Terms of Service</a> and <a target="_blank" href="https://login.condoally.com/PrivacyPolicy.html">Privacy Policy</a>, as well as our partner <a target="_blank" href="https://www.dwolla.com/legal/tos/">Dwolla's Terms of Service</a> and <a target="_blank" href="https://www.dwolla.com/legal/privacy/">Privacy Policy</a>.</label>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" data-ng-click="$ctrl.dwollaSignUp();">Agree and Sign-up for Dwolla Payments</button>
                    </div>

                    <div data-ng-if="$ctrl.dwollaUserStatus === 'document'">
                        <div data-ng-if="$ctrl.dwollaDocUploadMessage">
                            {{$ctrl.dwollaDocUploadMessage}}
                        </div>
                        <div data-ng-if="!$ctrl.dwollaDocUploadMessage">
                            In order for Dwolla to complete your identity verification, you need to upload a document confirming your identify. The image needs to be color and sharp, not blurry. If you have already done this, please
                            give Dwolla up to 2 full days to hear a response before contacting support. You can find more guidance on capturing the image here:
                            <br />
                            <a href="https://help.communityally.org/dwolla-identity-documentation-guidance/" target="_blank">https://help.communityally.org/dwolla-identity-documentation-guidance/</a>
                            <div class="mt-3">
                                <label>
                                    <b>Document Type:</b>
                                    <select data-ng-model="$ctrl.dwollaDocUploadType">
                                        <option value="license">State-Issued Driver's License</option>
                                        <option value="passport">Passport</option>
                                        <option value="idCard">Government-Issued ID Card</option>
                                    </select>
                                </label>
                                <br />
                                <input type="file" on-file-change="$ctrl.onDwollaDocSelected($event)" />
                                <br />
                                <br />
                                <button type="button" class="btn btn-primary" data-ng-click="$ctrl.uploadDwollaDoc()">Upload Document</button>
                            </div>
                        </div>
                    </div>

                    <div data-ng-if="$ctrl.dwollaUserStatus === 'suspended'" class="text-error">
                        It appears your account verification has failed. Please contact tech support using the message form in the bottom right of using <a href="#!/Help">this form</a>.
                    </div>
                </div>
            </div>
        </div>

        <div data-ng-if="$ctrl.shouldShowStripeAchMandate" class="modal-container">
            <div class="modal-overlay"></div>
            <div class="ca-modal-dialog modal-lg">
                <div class="loading-overlay" data-ng-show="$ctrl.isLoading_Payment"></div>
                Per Stripe's requirements, you must accept the following mandate to use ACH payments through Community Ally:
                <br />
                <br />
                If you use Community Ally's services or purchase additional products periodically pursuant to Community Ally's terms, you authorize Community Ally to debit your bank account periodically for auto-pay and on demand for manual payments. Payments that fall outside of the regular debits authorized above will only be debited after your authorization is obtained.
                <br />
                <div class="text-center mt-3">
                    <button type="button" class="btn btn-primary" data-ng-click="$ctrl.acceptStripeAchMandate(true)">Accept</button>
                    <button type="button" class="btn btn-secondary ms-3" data-ng-click="$ctrl.acceptStripeAchMandate(false)">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Stripe sign-up block -->
        <div id="stripe-sign-up-form" class="mb-4" data-ng-if="$ctrl.isStripeEnabledOnGroup && !$ctrl.usersStripeBankAccountHint">
            <div data-ng-if="!$ctrl.hasStripePlaidPendingMicroDeposits && !$ctrl.hasStripeAchPendingMicroDeposits">
                Community Ally uses <a href="https://stripe.com/docs/security" target="_blank">Stripe</a> to connect bank accounts for security and simplicity. Once you connect a bank account you'll be able to make payments via
                ACH. <a href="https://help.communityally.org/sign-up-with-stripe-to-make-payments/" target="_blank">Sign-up Help Guide</a>
                <div class="text-center mt-2">
                    <!--<button type="button" class="btn btn-primary" data-ng-click="$ctrl.startPlaidAchConnection()">Connect Checking Account{{($ctrl.isWePayPaymentActive || $ctrl.isDwollaReadyForPayment) ? " For Stripe" : ""}} via Plaid</button>-->
                    <button type="button" class="btn btn-primary" data-ng-click="$ctrl.startStripeAchConnection()">Connect Checking Account</button>
                </div>
            </div>

            <div class="mt-5" data-ng-if="$ctrl.hasStripePlaidPendingMicroDeposits">
                You have a pending account setup with Plaid. Please click the button below to complete the verification process.
                <div class="text-center mt-2">
                    <button type="button" class="btn btn-primary" data-ng-click="$ctrl.completeStripeMicroDeposits()">Complete Account Verification</button>
                    <br />
                    <br />
                    Or <span class="text-link note-text" data-ng-click="$ctrl.cancelStripeAccountAddition()">Cancel Process</span>
                </div>
            </div>

            <div class="mt-5" data-ng-if="$ctrl.hasStripeAchPendingMicroDeposits && !$ctrl.shouldShowStripeAchRefresh">
                You have a pending account setup with Stripe. Please click the button below to complete the verification process.
                <div class="text-center mt-2">
                    <button type="button" class="btn btn-primary" data-ng-click="$ctrl.verifyStripeMicroDeposits()">Verify Stripe Micro-Deposits</button>
                    <br />
                    <br />
                    Or <span class="text-link note-text" data-ng-click="$ctrl.cancelStripeAchMicroDeposits()">Cancel Process</span>
                </div>
            </div>

            <div class="mt-5" data-ng-if="$ctrl.hasStripeAchPendingMicroDeposits && $ctrl.shouldShowStripeAchRefresh">
                <div class="text-center mt-2">
                    In the new tab that just opened, enter your micro-deposit information. Once successfully completed, click the button to refresh the page.
                    <br />
                    <button type="button" class="btn btn-primary" data-ng-click="$ctrl.refreshPageAfterStripeVerify()">Refresh Page</button>
                    <br />
                    <br />
                    Or <span class="text-link note-text" data-ng-click="$ctrl.cancelStripeAchMicroDeposits()">Cancel Process</span>
                </div>
            </div>
        </div>

        <!-- Payment area -->
        <form data-ng-if="$ctrl.isWePayPaymentActive || $ctrl.isDwollaReadyForPayment || ($ctrl.isStripeEnabledOnGroup && $ctrl.usersStripeBankAccountHint)">
            <div class="pay_for mb-3" data-ng-if="!$ctrl.stripePaymentSucceeded">
                <div class="text-16 font-600">I am paying for</div>

                <div class="custom-controls-stacked">
                    <label class="custom-control custom-radio">
                        <input id="radioStacked1" name="payment" type="radio" value="periodic" class="form-check-input" data-ng-click="$ctrl.onSelectPaymentType('periodic')" ng-model="$ctrl.paymentInfo.paymentType">
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description">Assessment</span>
                    </label>
                    <label class="ms-3 custom-control custom-radio">
                        <input id="other" name="payment" type="radio" data-ng-click="$ctrl.onSelectPaymentType('other')" value="other" ng-model="$ctrl.paymentInfo.paymentType" class="form-check-input">
                        <span class="custom-control-indicator"></span>
                        <span class="custom-control-description">Other</span>
                    </label>
                </div>
            </div>

            <div class="amount_field row" data-ng-if="!$ctrl.stripePaymentSucceeded">
                <div class="col-sm-4 pay_check">
                    <label>Amount</label>
                    <input class="form-control" type="text" value="" data-ng-disabled="$ctrl.paymentInfo.paymentType == 'periodic'" data-ng-model="$ctrl.paymentInfo.amount" data-ng-change="$ctrl.onPaymentAmountChange()" autocomplete="off" data-lpignore="true" data-form-type="other" />
                </div>
                <div class="col-sm-8 memo">
                    <label>Memo</label>
                    <input class="form-control" type="text" placeholder="" data-ng-model="$ctrl.paymentInfo.note" autocomplete="off" data-lpignore="true" data-form-type="other" />
                    <div data-ng-show="$ctrl.paymentInfo.paymentType == 'periodic'" data-ng-click="$ctrl.onIncorrectPayDetails()" class="text-link margin-top-10">{{ $ctrl.errorPayInfoText }}</div>
                </div>
                <i class="error" ng-show="$ctrl.paymentError">{{$ctrl.paymentErrorMessage}}</i>
            </div>

            <div data-ng-if="$ctrl.isStripeEnabledOnGroup && $ctrl.usersStripeBankAccountHint" class="margin-top-30">
                <h5 data-ng-if="$ctrl.hasMultipleProviders">Stripe</h5>
                <p style="margin-bottom: 0;" data-ng-if="!$ctrl.stripePaymentSucceeded">
                    Your association has setup <a target="_blank" href="https://stripe.com/">Stripe</a> to safely and securely accept payments.
                </p>

                <div class="mt-3">
                    <div data-ng-if="!$ctrl.stripePaymentSucceeded">
                        You have connected Stripe to this account:
                        <br />
                        <b>{{$ctrl.usersStripeBankAccountHint}}</b>
                        - <span class="text-link note-text" data-ng-click="$ctrl.unlinkStripeFundingSource()">Unlink bank account</span>
                        <br />
                        <div data-ng-if="$ctrl.userHasStripeAutoPay" class="text-error my-3 mt-5 text-center" style="color: blue;">
                            NOTE: You have auto-pay setup so be careful of double payments.
                        </div>
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-primary" data-ng-click="$ctrl.submitStripeAchPayment()">Submit E-Check Payment via Stripe</button>
                            <br />
                            {{$ctrl.stripeAchFeeAmountString}}
                        </div>
                    </div>
                    <div data-ng-if="$ctrl.stripePaymentSucceeded">
                        <span style="font-size: x-large; color: blue;">Payment submitted successfully!</span>
                        <div class="mt-2">
                            (<span class="text-link note-text" data-ng-click="$ctrl.reloadPage()">OK</span>)
                        </div>
                    </div>
                </div>
            </div>

            <div data-ng-if="$ctrl.isWePayPaymentActive" class="margin-top-30">
                <h5 data-ng-if="$ctrl.hasMultipleProviders">WePay</h5>
                <p style="margin-bottom: 0;">Your association has setup <a target="_blank" href="https://www.wepay.com/">WePay</a> to safely and securely accept payments.</p>
                <div class="alert alert-warning" role="alert" data-ng-if="!$ctrl.isStripeEnabledOnGroup">
                    WePay payments are being disabled October 10. Please switch over to Stripe or a different payment provider before then. We'll be reaching out to users via email soon to help with this transition.
                </div>
                <p class="buttons text-center">
                    <span class="text-center d-inline-block">
                        <input type="button" class="btn btn-primary" data-ng-click="$ctrl.submitWePayPayment('ach');" value="Pay with E-Check">
                        <br />
                        {{ $ctrl.wePayAssessmentAchFeeLabel }}
                    </span>
                    <span class="text-center d-inline-block">
                        <input type="button" style="margin-left:1em;" class="btn btn-primary" data-ng-click="$ctrl.submitWePayPayment('cc');" value="Pay with Debit/Credit Card">
                        <br />
                        {{ $ctrl.wePayAssessmentCreditCardFeeLabel }}
                    </span>
                </p>
            </div>

            <div class="buttons margin-top-30 text-center" ng-if="$ctrl.isDwollaReadyForPayment">
                <div data-ng-if="$ctrl.hasMultipleProviders" class="text-start">
                    <h5>Dwolla</h5>
                </div>
                <p class="text-start" style="margin-bottom: 0;">You are setup to use <a target="_blank" href="https://www.dwolla.com/security/">Dwolla</a> to safely and securely submit payments.</p>
                <div class="alert alert-warning" role="alert" data-ng-if="!$ctrl.isStripeEnabledOnGroup">
                    Dwolla payments are being disabled October 10. Please switch over to Stripe or a different payment provider before then. We'll be reaching out to users via email soon to help with this transition.
                </div>

                <div class="text-center d-inline-block">
                    <div data-ng-if="$ctrl.dwollaPaymentMessage">
                        <span style="font-size: x-large; color: blue;">{{ $ctrl.dwollaPaymentMessage }}</span>
                        <div class="mt-2">
                            (<span class="text-link note-text" data-ng-click="$ctrl.reloadPage()">OK</span>)
                        </div>
                    </div>
                    <div data-ng-if="!$ctrl.dwollaPaymentMessage">
                        <input type="button" class="btn btn-primary" data-ng-if="!$ctrl.isLoading_Payment" data-ng-click="$ctrl.submitDwollaPayment()" value="Submit Payment">
                        <br />
                        <b>Clicking this button will submit payment.</b>
                        <div data-ng-if="$ctrl.currentDwollaAutoPayAmount > 0" class="text-error" style="color: blue;">
                            NOTE: You have auto-pay setup so be careful of double payments.
                        </div>
                        <div>
                            You can cancel within 24 hours of payment. {{$ctrl.dwollaFeePercent}}% fee ({{$ctrl.dwollaFeeAmountString}}, max ${{$ctrl.dwollaStripeMaxFee}}) applies.
                            <div class="mt-3 text-end note-text">
                                Account: <b>{{$ctrl.dwollaFundingSourceName}}</b> - <span class="text-link note-text" data-ng-click="$ctrl.unlinkDwollaFundingSource()">Unlink bank account</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="buttons margin-top-30 text-center" data-ng-if="$ctrl.showParagon">
                <p class="single_p text-start">
                    {{$ctrl.allyAppName}} uses <a target="_blank" href="https://paragonsolutions.com/"><img src="/assets/images/paragon-logo-black.png" alt="" /></a> to safely and securely handle payments.
                </p>

                <div class="text-center d-inline-block" data-ng-if="$ctrl.paragonCheckingLast4 || $ctrl.paragonCardLast4">
                    <!--<a id="paragon-pay-button" onclick="if( $ctrl.paymentInfo.amount < 1 ) return false; $( this ).hide(); $( '#paragon-spinner' ).show(); return true;" data-ng-href="https://stage.paragonsolutions.com/ws/hosted2.aspx?Username=54cE7DU2p%2bBh7h9uwJWW8Q%3d%3d&Password=jYvmN41tt1lz%2bpiazUqQYK9Abl73Z%2bHoBG4vOZImo%2bYlKTbPeNPwOcMB0%2bmIS3%2bs&MerchantKey=1293&Amount={{$ctrl.paymentInfo.amount}}{{$ctrl.paragonPaymentParams}}" class="btn btn-info" role="button">Pay Now</a>-->
                    <!--<input type="button" style="margin-left:1em;" class="btn btn-primary" data-ng-click="$ctrl.showParagonCheckingSignUpModal = true" value="Pay Modal">-->
                    ra
                    <div data-ng-if="$ctrl.paragonPaymentMessage" style="font-size: x-large; color: blue;">{{ $ctrl.paragonPaymentMessage }}</div>
                    <div data-ng-if="$ctrl.paragonCheckingLast4">
                        <input type="button" class="btn btn-primary" data-ng-click="$ctrl.submitParagonPayment('check')" value="Complete eCheck Payment Now Via Paragon">
                        <br />
                        Clicking this button will submit payment using the account ending in {{ $ctrl.paragonCheckingLast4 }}. $1 fee applies.
                    </div>
                    <div data-ng-if="$ctrl.paragonCardLast4" class="mt-3">
                        <input type="button" class="btn btn-primary" data-ng-click="$ctrl.submitParagonPayment('card')" value="Complete Credit Card Payment Now Via Paragon">
                        <br />
                        Clicking this button will submit payment using the account ending in {{ $ctrl.paragonCardLast4 }}. 2.9% + $0.30 fee applies.
                    </div>
                </div>

                <div class="text-center" data-ng-if="!$ctrl.paragonCheckingLast4 || !$ctrl.paragonCardLast4">
                    <br />
                    <input data-ng-if="!$ctrl.paragonCheckingLast4" type="button" style="margin-left:1em;" class="btn btn-primary" data-ng-click="$ctrl.showParagonSignUp()" value="Sign-up To Make Online Payments via Checking or Savings">
                    <br />
                    <input data-ng-if="!$ctrl.paragonCardLast4" type="button" style="margin-left:1em; margin-top: 1em;" class="btn btn-primary" data-ng-click="$ctrl.showParagonCreditSignUp()" value="Sign-up To Make Online Payments via Credit Card">
                </div>
            </div>

            <div class="modal-container" data-ng-show="$ctrl.showParagonCheckingSignUpModal" data-ng-escape="$ctrl.showParagonCheckingSignUpModal = false">
                <div class="modal-overlay" data-ng-click="$ctrl.showParagonCheckingSignUpModal = false"></div>
                <div class="ca-modal-dialog modal-lg">
                    <div class="loading-overlay" data-ng-show="$ctrl.isLoading_Payment"></div>
                    <span style="float: right;" class="close-x" data-ng-click="$ctrl.showParagonCheckingSignUpModal = false">&times;</span>
                    <h2>Your Payment Information</h2>
                    Enter your bank account information below to complete sign-up.
                    <h4 class="mt-2" style="text-decoration: underline">Your Contact Information</h4>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label for="billing-sign-up-first-name">First Name</label>
                            <input type="text" class="form-control" id="billing-sign-up-first-name" placeholder="First Name" data-ng-model="$ctrl.paragonSignUpInfo.firstName">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="billing-sign-up-last-name">Last Name</label>
                            <input type="text" class="form-control" id="billing-sign-up-last-name" placeholder="Last Name" data-ng-model="$ctrl.paragonSignUpInfo.lastName">
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label for="billing-sign-up-email">Email Address</label>
                            <input type="text" class="form-control" id="billing-sign-up-email" placeholder="Email Address" data-ng-model="$ctrl.paragonSignUpInfo.email">
                        </div>
                        <div class="form-group col-md-6">
                            <label for="billing-sign-up-phone">Phone Number</label>
                            <input type="text" class="form-control" id="billing-sign-up-phone" placeholder="Phone Number" data-ng-model="$ctrl.paragonSignUpInfo.phoneNumber">
                        </div>
                    </div>
                    <street-address-form data-should-hide-name="true" data-street-address="$ctrl.paragonSignUpInfo.billingAddress"></street-address-form>
                    <h4 class="mt-2" style="text-decoration: underline">Your Bank Account Information</h4>
                    <div class="row">
                        <label class="col-sm-2 col-12">Account Type:</label>
                        <div class="col-sm-5 col-12">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="acct-type-checking" data-ng-value="'CHECKING'" data-ng-model="$ctrl.paragonSignUpInfo.accountType">
                                <label class="form-check-label" for="acct-type-checking">Checking</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="acct-type-savings" data-ng-value="'SAVINGS'" data-ng-model="$ctrl.paragonSignUpInfo.accountType">
                                <label class="form-check-label" for="acct-type-savings">Savings</label>
                            </div>
                        </div>
                        <div class="col-sm-5 col-12">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="check-type-personal" data-ng-value="'PERSONAL'" data-ng-model="$ctrl.paragonSignUpInfo.checkType">
                                <label class="form-check-label" for="check-type-personal">Personal</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" id="check-type-business" data-ng-value="'BUSINESS'" data-ng-model="$ctrl.paragonSignUpInfo.checkType">
                                <label class="form-check-label" for="check-type-business">Business</label>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="form-group col-md-6">
                            <label for="billing-sign-up-routing">Routing Number</label>
                            <input id="billing-sign-up-routing" type="text" class="form-control" placeholder="Routing Number" data-ng-model="$ctrl.paragonSignUpInfo.routingNumber" />
                        </div>

                        <div class="form-group col-md-6">
                            <label for="billing-sign-up-account">Account Number</label>
                            <input id="billing-sign-up-account" type="text" class="form-control" placeholder="Account Number" data-ng-model="$ctrl.paragonSignUpInfo.checkAccountNumber" />
                        </div>
                    </div>
                    <div class="row" style="text-align: right;">
                        <div class="col-12">
                            <div class="text-error" data-ng-if="$ctrl.paragonSignUpError">Failed to Sign-up: {{$ctrl.paragonSignUpError}}</div>
                            <input type="button" style="margin-left:1em;" class="btn btn-primary" data-ng-click="$ctrl.submitParagonSignUp()" value="Submit">
                            <br />
                            <span class="note-text">
                                Your information will be transmitted to Paragon using a highly secure connection. Community Ally does not store any of your bank information.
                                <br />
                                This may take up to a minute.
                            </span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="modal-container" data-ng-if="$ctrl.showParagonCreditSignUpModal">
                <div class="modal-overlay"></div>
                <div class="ca-modal-dialog modal-lg">
                    <span style="float: right;" class="close-x" data-ng-click="$ctrl.hideParagonCreditSignUp()">&times;</span>
                    <h2>Enter Credit Card Information</h2>
                    <div class="note-text">This form is hosted on Paragon's servers so your information is never transmitted through Community Ally.</div>
                    <div data-ng-if="!$ctrl.paragonCardTokenizedUrl">
                        <img data-ng-if="$ctrl.paragonCardTokenizationMessage === 'Connecting...'" src="/assets/images/spinner-large.gif" />
                        <br />
                        {{ $ctrl.paragonCardTokenizationMessage }}
                    </div>
                    <iframe data-ng-if="$ctrl.paragonCardTokenizedUrl" style="width: 100%; height: 600px;" ng-src="{{$ctrl.paragonCardTokenizedUrl}}"></iframe>
                </div>
            </div>


            <!-- WePay Auto-Pay -->
            <fieldset data-ng-style="{'display': $ctrl.isWePayAutoPayActive ? 'block':'none'}">
                <legend>WePay Auto-Pay</legend>
                <div data-ng-show="$ctrl.isWePayAutoPayActive">
                    Auto-pay is successfully enabled. {{ $ctrl.nextAutoPayText }}<br />
                    <span class="text-button" data-ng-click="$ctrl.onDisableAutoPay()">Disable Auto-pay</span>
                </div>
                <div data-ng-hide="$ctrl.isWePayAutoPayActive">
                    <p>You can automatically send your assessment payment. {{ $ctrl.nextAutoPayText }}</p>
                    <div>
                        <div style="display:inline-block; text-align: center;">
                            <input type="button" class="btn btn-primary" data-ng-click="$ctrl.onSetupWePayAutoPay('ach');" value="Setup with E-Check">
                            <br />
                            {{ $ctrl.wePayAssessmentAchFeeLabel }}
                        </div>

                        <div style="display:inline-block; text-align: center;">
                            <input type="button" style="margin-left:1em;" class="btn btn-primary" data-ng-click="$ctrl.onSetupWePayAutoPay('cc');" value="Setup with Debit/Credit Card">
                            <br />
                            {{ $ctrl.wePayAssessmentCreditCardFeeLabel }}
                        </div>
                    </div>
                    <br />
                    <p class="note-text" style="color: red; display: none;" data-ng-show="$ctrl.payerPaysAchFee">
                        NOTE: There is currently an issue with WePay charging a higher transaction fee (1% + $1.30) than it should ($1.50)
                        on ACH pre-approvals. We'll update this as soon as we hear an update. In the meantime, consider making manual
                        payments.
                    </p>
                    <br />
                    <p class="note-text">
                        <cite>
                            Unfortunately, we cannot make any guarantees regarding the automatic payment system as that is handled by our
                            secure third-party payment provider. You are responsible for making sure your payments are made on time to
                            avoid any late penalties that your association may enforce.
                        </cite>
                    </p>
                </div>
            </fieldset>


            <!-- Dwolla Auto-Pay -->
            <fieldset class="mt-5" data-ng-if="$ctrl.shouldShowDwollaAutoPayArea">
                <legend style="font-size: large;">Auto-Pay</legend>
                <div data-ng-if="$ctrl.currentDwollaAutoPayAmount > 0">
                    Auto-pay is enabled for <b>{{$ctrl.currentDwollaAutoPayAmount | currency}}</b>. {{ $ctrl.nextAutoPayText }}
                    <br />
                    <br />
                    <span class="text-button" data-ng-click="$ctrl.disableDwollaAutoPay()">Disable Auto-pay</span>
                </div>
                <div data-ng-if="!$ctrl.currentDwollaAutoPayAmount">
                    <p>You can setup automatic assessment payments that will occur {{$ctrl.assessmentFrequencyInfo.name.toLowerCase()}} ({{$ctrl.assessmentFrequencyInfo.signUpNote}}). You will receive an email a few days before payment occurs. {{ $ctrl.nextAutoPayText }}</p>
                    <div>
                        <div style="display:inline-block; text-align: center;">
                            <!--$<input class="form-control" type="number" data-ng-model="$ctrl.newDwollaAutoPayAmount" style="display: inline; width: 200px;" data-ng-enter="$ctrl.enableDwollaAutoPay()" autocomplete="off" data-lpignore="true" data-form-type="other" />-->
                            Your auto-pay amount will be <b>{{$ctrl.assessmentAmount | currency}}</b>, your assessment payment.
                            <br />
                            <input type="button" class="btn btn-primary" data-ng-click="$ctrl.enableDwollaAutoPay()" value="Enable Auto-Pay">
                            <br />
                            {{$ctrl.dwollaFeePercent}}% fee ({{$ctrl.getDwollaFeeAmount($ctrl.assessmentAmount) | currency}}, max ${{$ctrl.dwollaStripeMaxFee}}) applies.
                        </div>
                    </div>
                    <br />
                    <p class="note-text">
                        <cite>
                            Unfortunately, we cannot make any guarantees regarding the automatic payment system as that is handled by our
                            secure third-party payment provider. You are responsible for making sure your payments are made on time to
                            avoid any late penalties that your association may enforce.
                        </cite>
                    </p>
                </div>
            </fieldset>

            <!-- Stripe Auto-Pay -->
            <fieldset class="mt-5" data-ng-if="$ctrl.shouldShowStripeAutoPayArea">
                <legend style="font-size: large;">Stripe Auto-Pay</legend>
                <div data-ng-if="$ctrl.userHasStripeAutoPay">
                    Auto-pay is enabled for <b>{{$ctrl.stripeAutoPayAmount | currency}}</b> (<span class="note-text">plus Stripe fees</span>). {{ $ctrl.nextAutoPayText }}
                    <br />
                    <br />
                    <div class="text-center"><button class="btn btn-warning" data-ng-click="$ctrl.disableStripeAutoPay()">Disable Auto-Pay</button></div>
                </div>
                <div data-ng-if="!$ctrl.userHasStripeAutoPay">
                    <p>You can setup automatic assessment payments that will occur {{$ctrl.assessmentFrequencyInfo.name.toLowerCase()}} ({{$ctrl.assessmentFrequencyInfo.signUpNote}}). You will receive an email a few days before payment occurs. {{ $ctrl.nextAutoPayText }}</p>
                    <div style="text-align: center;">
                        Your auto-pay amount will be <b>{{$ctrl.assessmentAmount | currency}}</b>, your assessment payment.
                        <br />
                        <input type="button" class="btn btn-primary" data-ng-click="$ctrl.startEnableStripeAutoPay()" value="Enable Auto-Pay">
                        <br />
                        {{$ctrl.stripeAutoPayFeeAmountString}} Stripe fee applies.
                    </div>
                    <br />
                    <p class="note-text">
                        <cite>
                            Unfortunately, we cannot make any guarantees regarding the automatic payment system as that is handled by our
                            secure third-party payment provider. You are responsible for making sure your payments are made on time to
                            avoid any late penalties that your association may enforce.
                        </cite>
                    </p>
                </div>
            </fieldset>

        </form>

        <div class="mb-2 mt-2" data-ng-if="$ctrl.dwollaBalance > 0 && !$ctrl.dwollaBalanceMessage">
            Dwolla Balance:
            <span class="fw-bold">{{$ctrl.dwollaBalance | currency}}</span>
            <span class="ms-3 text-link" data-ng-click="$ctrl.withdrawDwollaBalance()">Withdrawal</span>
        </div>

        <div class="mb-2 mt-2" data-ng-if="$ctrl.dwollaBalanceMessage">
            {{$ctrl.dwollaBalanceMessage}}
        </div>

        <div data-ng-if="$ctrl.myRecentPayments && $ctrl.myRecentPayments.length > 0">
            <h4>Recent Payments</h4>
            <div class="note-text">Payments from the last 2 weeks</div>
            <div class="row">
                <div class="col-4" data-ng-repeat="payment in $ctrl.myRecentPayments">
                    {{ payment.submitDateUtc | date:'shortDate' }}
                    <strong>{{ payment.amount | currency }}</strong>
                    <span class="note-text" data-ng-if="payment.electronic">{{payment.Status}}</span>
                </div>
            </div>
        </div>

        <div class="mt-5">
            <div class="manage_pannel text-end">
                <span class="text-link" data-ng-click="$ctrl.showExtraInfo = ($ctrl.showExtraInfo === 'payment-history' ? null : 'payment-history')" id="btn_view_pay_history">Payment History</span>
                <span class="text-link ms-3" data-ng-click="$ctrl.showExtraInfo = ($ctrl.showExtraInfo === 'payment-info' ? null : 'payment-info')" id="btn_view_pay_info">Payment Information</span>
                <resident-transactions class="ms-3" data-ng-if="$ctrl.shouldShowOwnerFinanceTxn"></resident-transactions>
            </div>

            <div class="mt-4">
                <div id="payment_history" data-ng-if="$ctrl.showExtraInfo === 'payment-history'">
                    <h4>Payment History</h4>
                    <div data-ng-if="$ctrl.historicPayments.length > 0" class="row">
                        <div class="col-6" data-ng-repeat="payment in $ctrl.historicPayments">
                            {{ payment.date | date:'shortDate' }}
                            <strong>{{ payment.amount | currency }}</strong>
                            <span class="note-text" data-ng-if="payment.electronic">{{payment.electronic.status}}</span>
                        </div>
                    </div>
                    <p data-ng-if="!$ctrl.historicPayments.length">You have no payment history.</p>
                    <!--<span class="text-link" data-ng-click="$ctrl.refreshHistoricPayments()">refresh</span>-->
                </div>

                <div id="pm_info" data-ng-if="$ctrl.showExtraInfo === 'payment-info'">
                    <h4>Payment Information</h4>
                    <p>You can pay your assessment online. {{ $ctrl.allyAppName }} uses a service called Stripe to process payments. There is a 1.6% processing fee if your association is using the {{ $ctrl.allyAppName }} free plan, or 0.8% if on the premium plan. We do not store your payment information at any time. Both {{ $ctrl.allyAppName }} and Stripe use the same security used by major banks to secure all information and data transfer. <a href="https://stripe.com/docs/security" target="_blank">Learn more about Stripe's security</a>. </p>

                    <!--<p>You can pay your assessment online. {{ $ctrl.allyAppName }} uses a service called WePay to process payment. We do not store your payment information at any time. Both {{ $ctrl.allyAppName }} and WePay use the same security used by major banks to secure all information and data transfer. <a href="https://support.wepay.com/entries/23064032-Security" target="_blank">Learn more about WePay's security</a>. </p>-->

                    <p><!--You can pay your assessment online. {{ $ctrl.allyAppName }} uses a service called Paragon to process payment. We do not store your payment information at any time. Both {{ $ctrl.allyAppName }} and Paragon use the same security used by major banks to secure all information and data transfer. <a href="https://paragonsolutions.com/compliance-security/" target="_blank">Learn more about Paragon's security</a>.--> </p>

                    <div data-ng-if="$ctrl.paragonCheckingLast4" class="mt-3 text-center">
                        <input type="button" class="btn btn-primary" data-ng-click="$ctrl.unenrollParagonAccount('check')" value="Un-enroll your checking account">
                    </div>

                    <div data-ng-if="$ctrl.paragonCardLast4" class="mt-3 text-center">
                        <input type="button" class="btn btn-primary" data-ng-click="$ctrl.unenrollParagonAccount('card')" value="Un-enroll your credit card account">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal-container" data-ng-show="$ctrl.shouldShowDwollaAddAccountModal">
        <div class="modal-overlay" data-ng-click=""></div>
        <div class="ca-modal-dialog modal-lg">
            <div class="loading-overlay" data-ng-show="$ctrl.isLoadingDwolla"></div>
            <span style="float: right;" class="close-x" data-ng-click="$ctrl.hideDwollaAddAccountModal()">&times;</span>
            <h2>Add Bank Account</h2>
            <span class="note-text">
                Note: For an extra layer of security, the account addition process takes place through Dwolla's servers only. The information you enter below does not
                interact with Community Ally's server.
            </span>
            <div id="dwolla-iav-container"></div>
            <div class="text-center" data-ng-if="$ctrl.isDwollaIavDone">
                <button type="button" class="btn btn-primary" data-ng-click="$ctrl.hideDwollaAddAccountModal()">Close</button>
            </div>
        </div>
    </div>

    <div class="modal-container" data-ng-if="$ctrl.shouldShowDwollaMicroDepositModal">
        <div class="modal-overlay" data-ng-click="$ctrl.shouldShowDwollaMicroDepositModal = false"></div>
        <div class="ca-modal-dialog modal-sm">
            <div class="loading-overlay" data-ng-show="$ctrl.isLoading"></div>
            <span style="float: right;" class="close-x" data-ng-click="$ctrl.shouldShowDwollaMicroDepositModal = false">&times;</span>
            <h2>Enter Micro-Deposit Amounts</h2>
            <div class="row m-1">
                <div class="col-sm-12 col-md-6">
                    <h3>Amount 1</h3>
                    <input type="text" data-ng-model="$ctrl.dwollaMicroDepositAmount1String" />
                </div>
                <div class="col-sm-12 col-md-6">
                    <h3>Amount 2</h3>
                    <input type="text" data-ng-model="$ctrl.dwollaMicroDepositAmount2String" />
                </div>
            </div>
            <div class="text-center">
                <div class="note-text">Order of amounts entered does not matter</div>
                <br />
                <div style="font-weight: bold;">
                    Entering the wrong amounts more than once can cancel the
                    verification process.
                </div>
                <button type="button" class="btn btn-primary mt-3" data-ng-click="$ctrl.submitDwollaMicroDepositAmounts()">Submit</button>
            </div>
        </div>
    </div>
</div>